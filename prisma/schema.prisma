generator client {
  provider = "prisma-client-js"
  output   = "../src/app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             Int            @id @default(autoincrement())
  name           String
  // NextAuthとの互換性を考えて 'image' と命名
  // DB上では分かりやすく 'image_url' にマッピング
  // 必須ではない場合は ? をつける
  image          String?        @map("image_url")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")

  // 【1対多】1人のユーザーは複数のカテゴリーを持つ（[ {id: 1, name: "カテゴリー名１"}, {id: 2, name: "カテゴリー名２"} ]）
  categories Category[]
  // 【1対多】1人のユーザーは複数のスポットを持つ
  spots      Spot[]
}

model Spot {
  id          Int            @id @default(autoincrement())
  name        String
  address     String
  createdAt   DateTime       @default(now()) @map("created_at")
  updatedAt   DateTime       @updatedAt @map("updated_at")
  
  // 【1対多】スポットは1人のユーザーに属する
  userId     Int      @map("user_id")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // 【1対多】スポットは1つのカテゴリーに属する
  // カテゴリーが消えてもスポットは残したいので ? (任意) にする
  categoryId Int?      @map("category_id")
  // onDelete: SetNull を指定して、カテゴリー削除時にここを null にすることでスポットを残す
  category   Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
}

model Category {
  id         Int            @id @default(autoincrement())
  name       String
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")

  // 【1対多】カテゴリーは1人のユーザーに属する
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // 【1対多】1つのカテゴリーは複数のスポットを持つ
  spots     Spot[]
}
